# Example Deployment for Dialysis.EHealthGateway
# Build: docker build -f src/Dialysis.EHealthGateway/Dockerfile -t <registry>/dialysis-ehealth-gateway:latest .
# Note: eHealth platforms (ePA, DMP) require certification; use stub adapter for development.
# For certified integration: set EHealth:De/KonnektorUrl (or Fr/Uk equivalents) and add cert secrets.
# See docs/ehealth/CERTIFICATION-CHECKLIST.md.
apiVersion: apps/v1
kind: Deployment
metadata:
  name: ehealth-gateway
  namespace: dialysis-pdms
spec:
  replicas: 1
  selector:
    matchLabels:
      app: ehealth-gateway
  template:
    metadata:
      labels:
        app: ehealth-gateway
    spec:
      containers:
        - name: ehealth-gateway
          image: <your-registry>/dialysis-ehealth-gateway:latest
          ports:
            - containerPort: 8080
          envFrom:
            - configMapRef:
                name: dialysis-config
            - secretRef:
                name: dialysis-secrets
          env:
            - name: EHealth__Platform
              value: "epa"
            - name: EHealth__Jurisdiction
              value: "DE"
            # Add for documentReferenceId: EHealth__DocumentsBaseUrl or EHealth__FhirBaseUrl
            # Add for consent: EHealth__AuditConsentBaseUrl
            # Certified DE: EHealth__De__KonnektorUrl (from secret). See docs/ehealth/CERTIFICATION-CHECKLIST.md
          livenessProbe:
            httpGet:
              path: /health
              port: 8080
            initialDelaySeconds: 15
            periodSeconds: 10
          readinessProbe:
            httpGet:
              path: /health
              port: 8080
            initialDelaySeconds: 5
            periodSeconds: 5
---
apiVersion: v1
kind: Service
metadata:
  name: ehealth-gateway
  namespace: dialysis-pdms
spec:
  selector:
    app: ehealth-gateway
  ports:
    - port: 8080
      targetPort: 8080
  type: ClusterIP

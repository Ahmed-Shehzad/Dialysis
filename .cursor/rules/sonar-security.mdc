---
description: SonarQube security rules. Apply when writing or reviewing code that handles sensitive data.
globs: "**/*.cs"
alwaysApply: false
---
# Sonar Security Rules

Align with Sonar Security (roslyn.sonaranalyzer.security.cs). Mandatory for code that touches secrets, SQL, or user input.

## Secrets & Credentials (S2068, S4818)

- **No hardcoded credentials**: Never commit passwords, API keys, connection strings, or tokens.
- Use configuration, environment variables, or Azure Key Vault.
- `SAS_KEY_VALUE` in tests is the documented emulator default; production must use real secrets from config.

## SQL Injection (S3649, S2077)

- Use parameterized queries. Never concatenate user input into SQL.
- EF Core `FromSqlRaw`/`ExecuteSqlRaw`â€”use parameters; avoid string interpolation of user data.

## Path Traversal (S5443)

- Validate and sanitize file paths from user input. Do not allow `..` or absolute paths into filesystem operations.

## Insecure Deserialization (S5542, S5527)

- Avoid `BinaryFormatter` and other insecure deserializers for untrusted data.
- Prefer `System.Text.Json` or `Newtonsoft.Json` with safe settings.

## Weak Cryptography (S2245, S5547)

- Do not use `Random` for security-sensitive values. Use `RandomNumberGenerator` or `Guid.NewGuid()`.
- Use strong algorithms (e.g. AES, SHA-256); avoid MD5, DES, RC4 for security purposes.

## Open Redirect (S5146)

- Validate redirect URLs. Do not redirect to user-supplied URLs without allowlisting.

## Logging Sensitive Data (S2068, S4790)

- Do not log passwords, tokens, or full connection strings.
- Mask or redact sensitive fields in logs and error messages.
